<ion-content class="ninja-bg">
  <div class="loading-container" *ngIf="!mision; else content">
    <div class="shuriken-spinner"></div>
    <p>Desencriptando pergamino...</p>
  </div>

  <ng-template #content>
    <div class="mision-detail-container">
      <div class="scroll-canvas">
        
        <button [routerLink]="['/tablon']" class="btn-back">
          <span>TABLÓN</span>
        </button>

        <header class="scroll-header">
          <div class="status-badge" [ngClass]="mision!.status.toLowerCase()">
            {{ mision!.status }}
          </div>
          <h1 class="mision-title">{{ mision!.title }}</h1>
          <div class="rank-requirement">
            NIVEL REQUERIDO: <span class="rank-text">{{ mision!.rankRequirement }}-RANK</span>
          </div>
        </header>

        <div class="scroll-body">
          <section class="briefing-section">
            <h2 class="section-label">INSTRUCCIONES</h2>
            <p class="description-text">{{ mision!.description }}</p>
            <div class="reward-box">
              <span class="ryo-icon">¥</span>
              <span class="amount">{{ mision!.reward }}</span>
              <span class="currency">RYOS</span>
            </div>
          </section>

          <hr class="scroll-divider">

          <div class="actions-area" *ngIf="mision!.status === 'DISPONIBLE'">
            <button 
              class="btn-ninja primary" 
              (click)="aceptarMision()">
              ACEPTAR MISIÓN
            </button>
          </div>

          <div class="report-area" *ngIf="mision!.status === 'ACEPTADA'">
            <h2 class="section-label">REPORTE DE CAMPO</h2>
            <textarea 
              [(ngModel)]="reporteTexto" 
              class="ninja-input" 
              placeholder="Describe los detalles de la infiltración...">
            </textarea>

            <div class="upload-section">
              <input type="file" (change)="capturarEvidencia($event)" accept="image/*" id="file-input" hidden>
              <label for="file-input" class="btn-ninja outline">
                <span class="material-symbols-outlined">add_a_photo</span>
                {{ imagenEvidencia ? 'EVIDENCIA CAPTURADA' : 'SUBIR FOTO' }}
              </label>

              <div class="preview-frame" *ngIf="imagenEvidencia">
                <img [src]="imagenEvidencia" alt="evidencia">
                <button class="btn-clear" (click)="imagenEvidencia = null">×</button>
              </div>
            </div>

            <footer class="action-footer">
              <button class="btn-ninja primary" (click)="entregarMision()">ENTREGAR</button>
              <button class="btn-ninja danger" (click)="abandonarMision()">ABANDONAR</button>
            </footer>
          </div>

          <div class="archived-area" *ngIf="mision!.status === 'COMPLETADA'">
            <div class="official-stamp">COMPLETADA</div>
            <p class="archive-text">Este pergamino ha sido sellado por el Hokage y archivado en la biblioteca secreta.</p>
          </div>

        </div> </div> </div>
  </ng-template>
</ion-content>